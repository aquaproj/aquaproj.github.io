"use strict";(self.webpackChunkaqua_docusaurus=self.webpackChunkaqua_docusaurus||[]).push([[8685],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>m});var i=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,i,a=function(e,t){if(null==e)return{};var o,i,a={},n=Object.keys(e);for(i=0;i<n.length;i++)o=n[i],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)o=n[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var p=i.createContext({}),s=function(e){var t=i.useContext(p),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},c=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},u="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var o=e.components,a=e.mdxType,n=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(o),d=a,m=u["".concat(p,".").concat(d)]||u[d]||y[d]||n;return o?i.createElement(m,r(r({ref:t},c),{},{components:o})):i.createElement(m,r({ref:t},c))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=o.length,r=new Array(n);r[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[u]="string"==typeof e?e:a,r[1]=l;for(var s=2;s<n;s++)r[s]=o[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,o)}d.displayName="MDXCreateElement"},611:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>y,frontMatter:()=>n,metadata:()=>l,toc:()=>s});var i=o(7462),a=(o(7294),o(3905));const n={sidebar_position:100},r="Git Repository root's policy file and policy commands",l={unversionedId:"reference/security/policy-as-code/git-policy",id:"reference/security/policy-as-code/git-policy",title:"Git Repository root's policy file and policy commands",description:"aqua >= v2.3.0",source:"@site/docs/reference/security/policy-as-code/git-policy.md",sourceDirName:"reference/security/policy-as-code",slug:"/reference/security/policy-as-code/git-policy",permalink:"/docs/reference/security/policy-as-code/git-policy",draft:!1,editUrl:"https://github.com/aquaproj/aquaproj.github.io/edit/main/docs/reference/security/policy-as-code/git-policy.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100},sidebar:"tutorialSidebar",previous:{title:"Policy as Code",permalink:"/docs/reference/security/policy-as-code/"},next:{title:"Why is Policy needed?",permalink:"/docs/reference/security/policy-as-code/why-policy-is-needed"}},p={},s=[{value:"How to use",id:"how-to-use",level:2},{value:"Why this feature is needed",id:"why-this-feature-is-needed",level:2},{value:"Design consideration",id:"design-consideration",level:2}],c={toc:s},u="wrapper";function y(e){let{components:t,...o}=e;return(0,a.kt)(u,(0,i.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"git-repository-roots-policy-file-and-policy-commands"},"Git Repository root's policy file and policy commands"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"aqua >= v2.3.0")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/aquaproj/aqua/issues/1789"},"#1789")," ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/aquaproj/aqua/pull/1808"},"1808")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," is a Policy file in the Git Repository root directory."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," must be located in one of the following paths from the Git Repository root directory."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"aqua-policy.yaml"),(0,a.kt)("li",{parentName:"ul"},".aqua-policy.yaml"),(0,a.kt)("li",{parentName:"ul"},"aqua/aqua-policy.yaml"),(0,a.kt)("li",{parentName:"ul"},".aqua/aqua-policy.yaml")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"The file extension ",(0,a.kt)("inlineCode",{parentName:"p"},".yml")," isn't supported at the moment.")),(0,a.kt)("p",null,"Before aqua executes or installs packages, aqua searches ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file"),".\naqua searches the Git repository root directory from the current directory to the root directory."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," isn't found, it is same as usual."),(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," is found, aqua checks if the policy file is already allowed or not."),(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," is already allowed, aqua uses ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," as Policy."),(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," isn't allowed, aqua outputs the warning and ignores ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file"),".")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy allow")," command is a command to allow a policy file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua policy allow [<policy file path>]\n")),(0,a.kt)("p",null,"If no argument is given, aqua allows ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file"),"."),(0,a.kt)("p",null,"Even if you allow a policy file once, you have to allow the policy file again if the policy file is modified."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Before you run ",(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy allow")," command, you should confirm the content of aqua-policy.yaml.\nIf untrusted Registries are used, you shouldn't run ",(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy allow"),".")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy deny")," command is a command to deny a policy file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua policy deny [<policy file path>]\n")),(0,a.kt)("p",null,"If no argument is given, aqua allows ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file"),"."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy deny")," is used to ignore ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," and suppress the warning."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"aqua searches ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," per ",(0,a.kt)("inlineCode",{parentName:"p"},"aqua.yaml"),". aqua searches ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository")," based on the directory where ",(0,a.kt)("inlineCode",{parentName:"p"},"aqua.yaml")," is located.")),(0,a.kt)("h2",{id:"how-to-use"},"How to use"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file")," to your Git repository"),(0,a.kt)("li",{parentName:"ol"},"Run ",(0,a.kt)("inlineCode",{parentName:"li"},"aqua policy allow")," in the repository")),(0,a.kt)("p",null,"Please see ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/policy-as-code"},"Getting Started"),"."),(0,a.kt)("h2",{id:"why-this-feature-is-needed"},"Why this feature is needed"),(0,a.kt)("p",null,"To improve the user experience of non Standard Registries.\nTo set up Policy easily keeping the security."),(0,a.kt)("p",null,"To use non Standard Registries, you had to set the environment variable ",(0,a.kt)("inlineCode",{parentName:"p"},"AQUA_POLICY_CONFIG"),".\nBut it is bothersome, especially in the team development because all members have to set the environment variable ",(0,a.kt)("inlineCode",{parentName:"p"},"AQUA_POLICY_CONFIG"),".\nSome tools such as ",(0,a.kt)("inlineCode",{parentName:"p"},"direnv")," are useful to set environment variables, but it is undesirable to ask users to install additional tools for aqua."),(0,a.kt)("p",null,"So we would like to apply a policy without ",(0,a.kt)("inlineCode",{parentName:"p"},"AQUA_POLICY_CONFIG"),", but at the same time we have to keep the security."),(0,a.kt)("h2",{id:"design-consideration"},"Design consideration"),(0,a.kt)("p",null,"Sometimes security and convenience are conflicted, so we have to be careful not to harm security for convenience.\nTo keep the security, I think aqua should ask users to allow ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," explicitly.\nThis means aqua should not apply ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," without user's approval.\nSo aqua asks users to allow ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file")," using ",(0,a.kt)("inlineCode",{parentName:"p"},"aqua policy allow")," command."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Unlike ",(0,a.kt)("inlineCode",{parentName:"p"},"Git Repository root's policy file"),", aqua uses policy files in ",(0,a.kt)("inlineCode",{parentName:"p"},"AQUA_POLICY_CONFIG")," without your approval.\nBecause"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"To keep the compatibility"),(0,a.kt)("li",{parentName:"ul"},"Unlike ",(0,a.kt)("inlineCode",{parentName:"li"},"Git Repository root's policy file"),", the environment variable ",(0,a.kt)("inlineCode",{parentName:"li"},"AQUA_POLICY_CONFIG")," is set by you, so aqua regards ",(0,a.kt)("inlineCode",{parentName:"li"},"AQUA_POLICY_CONFIG")," as your approval"))))}y.isMDXComponent=!0}}]);