"use strict";(self.webpackChunkaqua_docusaurus=self.webpackChunkaqua_docusaurus||[]).push([[2393],{3905:(e,a,t)=>{t.d(a,{Zo:()=>l,kt:()=>k});var n=t(7294);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function u(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?u(Object(t),!0).forEach((function(a){s(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},u=Object.keys(e);for(n=0;n<u.length;n++)t=u[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(n=0;n<u.length;n++)t=u[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=n.createContext({}),o=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):c(c({},a),e)),t},l=function(e){var a=o(e.components);return n.createElement(i.Provider,{value:a},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,s=e.mdxType,u=e.originalType,i=e.parentName,l=r(e,["components","mdxType","originalType","parentName"]),m=o(t),p=s,k=m["".concat(i,".").concat(p)]||m[p]||d[p]||u;return t?n.createElement(k,c(c({ref:a},l),{},{components:t})):n.createElement(k,c({ref:a},l))}));function k(e,a){var t=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var u=t.length,c=new Array(u);c[0]=p;var r={};for(var i in a)hasOwnProperty.call(a,i)&&(r[i]=a[i]);r.originalType=e,r[m]="string"==typeof e?e:s,c[1]=r;for(var o=2;o<u;o++)c[o]=t[o];return n.createElement.apply(null,c)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},91:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>d,frontMatter:()=>u,metadata:()=>r,toc:()=>o});var n=t(7462),s=(t(7294),t(3905));const u={sidebar_position:70},c="Checksum Verification",r={unversionedId:"tutorial-extras/checksum",id:"tutorial-extras/checksum",title:"Checksum Verification",description:"* Blog Post written in Japanese",source:"@site/docs/tutorial-extras/checksum.md",sourceDirName:"tutorial-extras",slug:"/tutorial-extras/checksum",permalink:"/docs/tutorial-extras/checksum",draft:!1,editUrl:"https://github.com/aquaproj/aquaproj.github.io/edit/main/docs/tutorial-extras/checksum.md",tags:[],version:"current",sidebarPosition:70,frontMatter:{sidebar_position:70},sidebar:"tutorialSidebar",previous:{title:"Update packages by Renovate",permalink:"/docs/tutorial-extras/renovate"},next:{title:"Update aqua by aqua update-aqua command",permalink:"/docs/tutorial-extras/update-aqua"}},i={},o=[{value:"<code>aqua update-checksum</code> command",id:"aqua-update-checksum-command",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Autoupdate <code>aqua-checksums.json</code> by GitHub Actions",id:"autoupdate-aqua-checksumsjson-by-github-actions",level:3},{value:"Question: Should <code>aqua-checksums.json</code> be managed with Git?",id:"question-should-aqua-checksumsjson-be-managed-with-git",level:2},{value:"Reference",id:"reference",level:2}],l={toc:o},m="wrapper";function d(e){let{components:a,...t}=e;return(0,s.kt)(m,(0,n.Z)({},l,t,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"checksum-verification"},"Checksum Verification"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://zenn.dev/shunsuke_suzuki/articles/aqua-checksum-verification"},"Blog Post written in Japanese"))),(0,s.kt)("p",null,"Checksum Verification is a feature verifying downloaded assets with checksum.\nChecksum Verification prevents the supply chain attack and allows you to install tools securely."),(0,s.kt)("p",null,"By default, checksum verification is disabled.\nTo enable it, please add the configuration to ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua.yaml"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"checksum:\n  enabled: true\nregistries:\n  - type: standard\n    ref: v3.90.0 # renovate: depName=aquaproj/aqua-registry\npackages:\n  - name: golangci/golangci-lint@v1.46.2\n")),(0,s.kt)("p",null,"aqua creates or updates a file ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua-checksums.json")," in the same directory as aqua configuration file ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua.yaml")," and writes checksums."),(0,s.kt)("p",null,"e.g. ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua-checksums.json")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "checksums": [\n    {\n      "id": "github_release/github.com/golangci/golangci-lint/v1.49.0/golangci-lint-1.49.0-darwin-amd64.tar.gz",\n      "checksum": "20cd1215e0420db8cfa94a6cd3c9d325f7b39c07f2415a02d111568d8bc9e271",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/golangci/golangci-lint/v1.49.0/golangci-lint-1.49.0-darwin-arm64.tar.gz",\n      "checksum": "cabb1a4c35fe1dadbe5a81550a00871281a331e7660cd85ae16e936a7f0f6cfc",\n      "algorithm": "sha256"\n    }\n  ]\n}\n')),(0,s.kt)("p",null,"Many tools publish checksum files, so aqua gets checksums from them."),(0,s.kt)("p",null,"e.g."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://releases.hashicorp.com/terraform/1.2.7/terraform_1.2.7_SHA256SUMS"},"Terraform")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/cli/cli/releases/download/v2.14.4/gh_2.14.4_checksums.txt"},"GitHub CLI"))),(0,s.kt)("p",null,"If no checksum file for a tool is published, aqua can also get checksums by downloading assets and calculating checksums."),(0,s.kt)("h2",{id:"aqua-update-checksum-command"},(0,s.kt)("inlineCode",{parentName:"h2"},"aqua update-checksum")," command"),(0,s.kt)("p",null,"You can create or update ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua-checksums.json")," without installing tools by ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua update-checksum")," command."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua update-checksum\n")),(0,s.kt)("p",null,"By default, ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua update-checksum")," doesn't add checksums if the package's checksum configuration is disabled."),(0,s.kt)("p",null,"e.g. ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/aquaproj/aqua-registry/blob/66c791c3cbbeb8847d175fbe2530a921539bbd8f/registry.yaml#L4192-L4205"},"https://github.com/aquaproj/aqua-registry/blob/66c791c3cbbeb8847d175fbe2530a921539bbd8f/registry.yaml#L4192-L4205")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"  - type: github_release\n    repo_owner: cycloidio\n    repo_name: terracognita\n    asset: terracognita-{{.OS}}-{{.Arch}}.tar.gz\n    checksum:\n      enabled: false\n")),(0,s.kt)("p",null,"If ",(0,s.kt)("inlineCode",{parentName:"p"},"-deep")," option is set, ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua update-checksum")," downloads assets and calculate checksums."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua update-checksum -deep\nINFO[0001] downloading an asset to calculate the checksum  aqua_version= asset_name=terracognita-darwin-amd64.tar.gz checksum_env=darwin/amd64 env=linux/amd64 package_name=cycloidio/terracognita package_registry=standard package_version=v0.8.1 program=aqua\nINFO[0008] downloading an asset to calculate the checksum  aqua_version= asset_name=terracognita-windows-amd64.tar.gz checksum_env=windows/amd64 env=linux/amd64 package_name=cycloidio/terracognita package_registry=standard package_version=v0.8.1 program=aqua\nINFO[0014] downloading an asset to calculate the checksum  aqua_version= asset_name=terracognita-linux-amd64.tar.gz checksum_env=linux/amd64 env=linux/amd64 package_name=cycloidio/terracognita package_registry=standard package_version=v0.8.1 program=aqua\n")),(0,s.kt)("h2",{id:"getting-started"},"Getting Started"),(0,s.kt)("p",null,"Install aqua v1.20.0 or later."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua -v\naqua version 1.22.0 (869d7b46a0697a5938dffd02a7ea219406762bf2)\n")),(0,s.kt)("p",null,"Scaffold ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua.yaml")," and edit to enable the checksum verification."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua init\n$ vi aqua.yaml\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n# aqua - Declarative CLI Version Manager\n# https://aquaproj.github.io/\nchecksum:\n  enabled: true\nregistries:\n- type: standard\n  ref: v3.66.0 # renovate: depName=aquaproj/aqua-registry\npackages:\n")),(0,s.kt)("p",null,"And add ",(0,s.kt)("inlineCode",{parentName:"p"},"suzuki-shunsuke/tfcmt")," by ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua g")," command."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua g -i suzuki-shunsuke/tfcmt\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"packages:\n- name: suzuki-shunsuke/tfcmt@v4.0.0\n")),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua update-checksum"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},'$ aqua update-checksum\nINFO[0000] updating a package checksum                   aqua_version=1.22.0 env=darwin/arm64 package_name=suzuki-shunsuke/tfcmt package_registry=standard package_version=v4.0.0 program=aqua\n\n$ cat aqua-checksums.json\n{\n  "checksums": [\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_amd64.tar.gz",\n      "checksum": "346d43e34ee990c26ebcbc80936bea6d6f524bcc446aa74d1f07c42708fc480b",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz",\n      "checksum": "372986bfaddbfeb680329341568fc4fba0d6fa651b941bf4154585b7baaa67db",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_linux_amd64.tar.gz",\n      "checksum": "e950763e64504e40a45c75c81a35d115f98f164264e159e4e4b7e2534d3d8087",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_linux_arm64.tar.gz",\n      "checksum": "8ce944ccaf7ff5a150b256d75d8fe3d04ba741d5586bb5f100b9df80294f14fa",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_windows_amd64.tar.gz",\n      "checksum": "2228e167f3ddf61e6ccfd30648cf649f7b18d98eb6b2150e6c3522183628bda9",\n      "algorithm": "sha256"\n    },\n    {\n      "id": "github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_windows_arm64.tar.gz",\n      "checksum": "5435b0d4cca909f752dce456fd186bef2de994f7d1c24665fa8507e9d6019e5b",\n      "algorithm": "sha256"\n    }\n  ]\n}\n')),(0,s.kt)("p",null,"If tfcmt v4.0.0 is already installed, please uninstall once."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua which tfcmt\n/Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz/tfcmt\n\n$ rm -Rf /Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0\n")),(0,s.kt)("p",null,"And run ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua i"),". tfcmt will be installed successfully."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ aqua i\nINFO[0000] download and unarchive the package            aqua_version=1.22.0 env=darwin/arm64 package_name=suzuki-shunsuke/tfcmt package_version=v4.0.0 program=aqua registry=standard\n")),(0,s.kt)("p",null,"To confirm the checksum verification, let's edit the checksum in ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua-checksums.json")," intentionally."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},'$ cp aqua-checksums.json aqua-checksums.json.orig\n$ vi aqua-checksums.json\n$ diff aqua-checksums.json aqua-checksums.json.orig \n10c10\n<       "checksum": "372986bfaddbfeb680329341568fc4fba0d6fa651b941bf4154585b7baaa67d0",\n---\n>       "checksum": "372986bfaddbfeb680329341568fc4fba0d6fa651b941bf4154585b7baaa67db",\n')),(0,s.kt)("p",null,"And try to reinstall tfcmt."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},'$ rm -Rf /Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0\n$ aqua i\nINFO[0000] download and unarchive the package            aqua_version=1.22.0 env=darwin/arm64 package_name=suzuki-shunsuke/tfcmt package_version=v4.0.0 program=aqua registry=standard\nERRO[0000] install the package                           actual_checksum=372986BFADDBFEB680329341568FC4FBA0D6FA651B941BF4154585B7BAAA67DB aqua_version=1.22.0 env=darwin/arm64 error="checksum is invalid" expected_checksum="&{github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz 372986BFADDBFEB680329341568FC4FBA0D6FA651B941BF4154585B7BAAA67D0 sha256}" package_name=suzuki-shunsuke/tfcmt package_version=v4.0.0 program=aqua registry=standard\nFATA[0000] aqua failed                                   aqua_version=1.22.0 env=darwin/arm64 error="it failed to install some packages" program=aqua\n')),(0,s.kt)("p",null,"Then it failed to install tfcmt because the checksum is wrong.\nOf course, tfcmt isn't installed."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ ls /Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0\ngls: cannot access '/Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0': No such file or directory\n")),(0,s.kt)("p",null,"The checksum verification also works in the lazy install."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},'$ tfcmt -v\nINFO[0000] download and unarchive the package            aqua_version=1.22.0 env=darwin/arm64 exe_path=/Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz/tfcmt package=suzuki-shunsuke/tfcmt package_name=suzuki-shunsuke/tfcmt package_version=v4.0.0 program=aqua registry=standard\nFATA[0001] aqua failed                                   actual_checksum=372986BFADDBFEB680329341568FC4FBA0D6FA651B941BF4154585B7BAAA67DB aqua_version=1.22.0 env=darwin/arm64 error="checksum is invalid" expected_checksum="&{github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz 372986BFADDBFEB680329341568FC4FBA0D6FA651B941BF4154585B7BAAA67D0 sha256}" program=aqua\n')),(0,s.kt)("p",null,"Let's fix .aqua-chcksums.json, then you can install tfcmt."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-console"},"$ cp aqua-checksums.json.orig aqua-checksums.json\n$ tfcmt -v\nINFO[0000] download and unarchive the package            aqua_version=1.22.0 env=darwin/arm64 exe_path=/Users/shunsukesuzuki/.local/share/aquaproj-aqua/pkgs/github_release/github.com/suzuki-shunsuke/tfcmt/v4.0.0/tfcmt_darwin_arm64.tar.gz/tfcmt package=suzuki-shunsuke/tfcmt package_name=suzuki-shunsuke/tfcmt package_version=v4.0.0 program=aqua registry=standard\ntfcmt version 4.0.0 (047e980d083da80303e6e8f4ebf6d5c9e7859716)\n")),(0,s.kt)("h3",{id:"autoupdate-aqua-checksumsjson-by-github-actions"},"Autoupdate ",(0,s.kt)("inlineCode",{parentName:"h3"},"aqua-checksums.json")," by GitHub Actions"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/aquaproj/example-update-checksum"},"https://github.com/aquaproj/example-update-checksum")),(0,s.kt)("h2",{id:"question-should-aqua-checksumsjson-be-managed-with-git"},"Question: Should ",(0,s.kt)("inlineCode",{parentName:"h2"},"aqua-checksums.json")," be managed with Git?"),(0,s.kt)("p",null,"Yes. You should manage ",(0,s.kt)("inlineCode",{parentName:"p"},"aqua-checksums.json")," with Git."),(0,s.kt)("h2",{id:"reference"},"Reference"),(0,s.kt)("p",null,"Please see ",(0,s.kt)("a",{parentName:"p",href:"/docs/reference/checksum"},"reference")," too."))}d.isMDXComponent=!0}}]);