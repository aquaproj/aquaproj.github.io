"use strict";(self.webpackChunkaqua_docusaurus=self.webpackChunkaqua_docusaurus||[]).push([[4122],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>f});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=n.createContext({}),s=function(e){var a=n.useContext(u),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},c=function(e){var a=s(e.components);return n.createElement(u.Provider,{value:a},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(t),m=r,f=p["".concat(u,".").concat(m)]||p[m]||d[m]||o;return t?n.createElement(f,i(i({ref:a},c),{},{components:t})):n.createElement(f,i({ref:a},c))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var u in a)hasOwnProperty.call(a,u)&&(l[u]=a[u]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},9206:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=t(7462),r=(t(7294),t(3905));const o={sidebar_position:700},i="Build Container (Docker) Image",l={unversionedId:"guides/build-container-image",id:"guides/build-container-image",title:"Build Container (Docker) Image",description:"When building a container (Docker) image, you may want to download and install tools from GitHub Releases or other sources.",source:"@site/docs/guides/build-container-image.md",sourceDirName:"guides",slug:"/guides/build-container-image",permalink:"/docs/guides/build-container-image",draft:!1,editUrl:"https://github.com/aquaproj/aquaproj.github.io/edit/main/docs/guides/build-container-image.md",tags:[],version:"current",sidebarPosition:700,frontMatter:{sidebar_position:700},sidebar:"tutorialSidebar",previous:{title:"Install Standard Registry's all packages very quickly",permalink:"/docs/guides/install-all-packages"},next:{title:"Wrap aqua with task runner such as GNU Make",permalink:"/docs/guides/wrap-aqua-with-task-runner"}},u={},s=[{value:"Remove aqua from Image",id:"remove-aqua-from-image",level:2},{value:"Notes of <code>aqua cp</code>",id:"notes-of-aqua-cp",level:2}],c={toc:s},p="wrapper";function d(e){let{components:a,...t}=e;return(0,r.kt)(p,(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"build-container-docker-image"},"Build Container (Docker) Image"),(0,r.kt)("p",null,"When building a container (Docker) image, you may want to download and install tools from GitHub Releases or other sources.\nIn particular, if you run CI with CircleCI or Google Cloud Build, you may want to install tools for CI on the image."),(0,r.kt)("p",null,"Traditionally, you would use curl, tar, unzip, etc. to install these tools, but with aqua, you can declaratively manage them.\nYou don't have to look up download URLs, formats, etc. yourself.\nYou can also use Renovate to automate updates."),(0,r.kt)("p",null,"aqua.yaml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n# aqua - Declarative CLI Version Manager\n# https://aquaproj.github.io/\nregistries:\n- type: standard\n  ref: v3.19.0 # renovate: depName=aquaproj/aqua-registry\npackages:\n- name: rhysd/actionlint@v1.6.15\n- name: golangci/golangci-lint@v1.47.2\n- name: reviewdog/reviewdog@v0.14.1\n")),(0,r.kt)("p",null,"Dockerfile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},"FROM alpine:3.16\nRUN apk add curl\nRUN curl -sSfL https://raw.githubusercontent.com/aquaproj/aqua-installer/v1.1.0/aqua-installer | sh -s -- -i /usr/local/bin/aqua -v v1.18.0\nCOPY aqua.yaml /aqua.yaml\nRUN aqua -c /aqua.yaml i\nENV AQUA_GLOBAL_CONFIG=/aqua.yaml\nENV PATH=/root/.local/share/aquaproj-aqua/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n")),(0,r.kt)("h2",{id:"remove-aqua-from-image"},"Remove aqua from Image"),(0,r.kt)("p",null,"aqua >= ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/aquaproj/aqua/releases/tag/v1.18.0"},"v1.18.0")),(0,r.kt)("p",null,"In the above Docker image, aqua is installed and used internally to execute tools.\nHowever, if you do not want to install anything extra in the Docker image, if you want to keep the image minimal, or if you do not want to switch tool versions with aqua,\nyou can also remove aqua using the Multistage Build and ",(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp")," command."),(0,r.kt)("p",null,"Dockerfile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dockerfile"},"FROM alpine:3.16 AS aqua\nRUN apk add curl\nRUN curl -sSfL https://raw.githubusercontent.com/aquaproj/aqua-installer/v1.1.0/aqua-installer | sh -s -- -i /usr/local/bin/aqua -v v1.18.0\nCOPY aqua.yaml /aqua.yaml\nRUN aqua -c /aqua.yaml cp -o /dist actionlint reviewdog\n\nFROM alpine:3.16.1\nRUN apk --no-cache add ca-certificates\nCOPY --from=aqua /dist/* /usr/local/bin/\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp")," installs specified tools and copies executable files to the specified directory.\nIn the above example, actionlint and reviewdog are installed and copied under /dist.\nOnly executable files are installed in the final image."),(0,r.kt)("h2",{id:"notes-of-aqua-cp"},"Notes of ",(0,r.kt)("inlineCode",{parentName:"h2"},"aqua cp")),(0,r.kt)("p",null,"There is a caveat to ",(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp"),".\n",(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp")," copies only executable files from packages.\nTherefore, tools that do not work with a single file will not work properly even if they are copied by ",(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp"),".\nIf the tool is a single binary written in Go, there is basically no problem, but if it is a shell script depending on another files in the same repository, it will not work properly."),(0,r.kt)("p",null,"For example, tfenv will not work correctly even if you copy it by ",(0,r.kt)("inlineCode",{parentName:"p"},"aqua cp"),".\nYou need to install those tools in a different way."))}d.isMDXComponent=!0}}]);